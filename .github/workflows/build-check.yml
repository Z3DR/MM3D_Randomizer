name: MM3DR Build Check

on:
  pull_request:

jobs:
  format:
    name: Verify Formatting
    runs-on: ubuntu-latest

    steps:
    - name: Checkout Project
      uses: actions/checkout@v3

#    - name: Format Project
#      uses: DoozyX/clang-format-lint-action@v0.15
#      with:
#        source: "./code ./source"
#        extensions: 'c,h,cpp,hpp'
#        clangFormatVersion: 14

  build:
    name: Confirm Compilable
    runs-on: ubuntu-latest
    container:
      image: ghcr.io/z3dr/randotools:latest

    steps:
    - name: Checkout Project
      uses: actions/checkout@v3
      with:
        token: ${{ secrets.TOKEN }}
        ssh-key: ${{ secrets.SSH_KEY }}

    - name: Compile Project
      run: |
        apt install openssh -y
        eval `ssh-agent -s`
        ssh-agent sh -c 'echo "${{ secrets.SSH_KEY }}" | ssh-add -'
        make -j